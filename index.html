<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>What did you get done today?</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
      }

      .header-content h1 {
        font-size: 2.5em;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
      }

      .auth-section {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.7);
        padding: 10px 15px;
        border-radius: 12px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #667eea;
      }

      .sign-in-container {
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 60px 40px;
        margin: 100px auto;
        max-width: 500px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .sign-in-container h2 {
        font-size: 2em;
        margin-bottom: 20px;
        color: #4a5568;
      }

      .sign-in-container p {
        color: #718096;
        margin-bottom: 30px;
        font-size: 1.1em;
      }

      .google-sign-in-btn {
        background: white;
        border: 2px solid #dadce0;
        border-radius: 12px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        transition: all 0.3s ease;
        color: #3c4043;
      }

      .google-sign-in-btn:hover {
        background: #f8f9fa;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .google-icon {
        width: 20px;
        height: 20px;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .app-content {
        display: none;
      }

      .app-content.visible {
        display: block;
      }

      .nav-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .nav-tab {
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.5);
        border: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .nav-tab.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .controls {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
      }

      .control-group {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .control-group h3 {
        color: #4a5568;
        margin-bottom: 15px;
        font-size: 1.1em;
      }

      input,
      select,
      button {
        width: 100%;
        padding: 12px;
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 10px;
        font-size: 14px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
      }

      input[type="number"] {
        appearance: textfield;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.2s ease;
      }

      button:hover {
        transform: translateY(-2px);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .priority-input {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .priority-slider {
        flex: 1;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: linear-gradient(90deg, #48bb78, #ecc94b, #e53e3e);
        border-radius: 5px;
        outline: none;
      }

      .priority-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .priority-value {
        width: 40px;
        text-align: center;
        font-weight: 600;
      }

      .task-list-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .task-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: center;
      }

      .project-filter {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .project-checkbox {
        display: flex;
        align-items: center;
        gap: 5px;
        background: rgba(255, 255, 255, 0.7);
        padding: 5px 15px;
        border-radius: 20px;
        cursor: pointer;
      }

      .project-checkbox input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      .task-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .task-item {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .task-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .task-info-left {
        flex: 1;
      }

      .task-title {
        font-weight: 600;
        font-size: 1.1em;
        margin-bottom: 5px;
      }

      .task-details {
        color: #718096;
        font-size: 0.9em;
      }

      .task-score {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9em;
      }

      .project-badge {
        display: inline-block;
        background: rgba(102, 126, 234, 0.2);
        color: #667eea;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        font-weight: 500;
        margin-right: 8px;
      }

      .settings-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        margin: 0 auto;
      }

      .settings-group {
        margin-bottom: 25px;
      }

      .settings-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 10px;
        color: #4a5568;
      }

      .timeline-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .timeline-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .timeline-controls {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }

      .scroll-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.7);
        padding: 8px 12px;
        border-radius: 12px;
        backdrop-filter: blur(5px);
      }

      .scroll-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 16px;
      }

      .scroll-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .today-btn {
        background: linear-gradient(135deg, #48bb78, #38a169);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        font-size: 14px;
      }

      .today-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
      }

      .zoom-slider {
        width: 300px;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 5px;
        outline: none;
      }

      .zoom-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .gantt-chart {
        overflow-x: auto;
        border-radius: 15px;
        background: #f8fafc;
        padding: 20px;
      }

      .chart-header {
        display: flex;
        background: #e2e8f0;
        border-radius: 10px;
        margin-bottom: 10px;
        min-width: 100%;
      }

      .task-column {
        width: 200px;
        padding: 15px;
        font-weight: 600;
        color: #4a5568;
      }

      .timeline-column {
        flex: 1;
        min-width: 800px;
        position: relative;
      }

      .date-markers {
        display: flex;
        height: 40px;
        border-bottom: 2px solid #cbd5e0;
        position: relative;
      }

      .date-marker {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: #718096;
        border-right: 1px solid #e2e8f0;
        position: relative;
      }

      .date-marker.today {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        font-weight: 600;
      }

      .date-marker.key-date {
        background: rgba(118, 75, 162, 0.1);
        color: #764ba2;
        font-weight: 600;
      }

      .date-marker.center-date {
        background: rgba(118, 75, 162, 0.05);
        border: 2px solid rgba(118, 75, 162, 0.3);
      }

      .timeline-info {
        text-align: center;
        margin-bottom: 15px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 10px;
        font-size: 14px;
        color: #4a5568;
      }

      .chart-row {
        display: flex;
        border-bottom: 1px solid #e2e8f0;
        min-height: 60px;
        align-items: center;
      }

      .task-info {
        width: 200px;
        padding: 15px;
        background: white;
        border-right: 2px solid #e2e8f0;
      }

      .task-name {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 5px;
      }

      .task-duration {
        font-size: 12px;
        color: #718096;
      }

      .timeline-row {
        flex: 1;
        min-width: 800px;
        position: relative;
        height: 60px;
      }

      .task-bar {
        position: absolute;
        height: 30px;
        top: 15px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        padding: 0 15px;
        color: white;
        font-weight: 500;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #667eea, #764ba2);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .task-bar:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .task-bar.active {
        background: linear-gradient(135deg, #48bb78, #38a169);
        box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
      }

      .task-bar.completed {
        background: linear-gradient(135deg, #718096, #4a5568);
        box-shadow: 0 4px 15px rgba(113, 128, 150, 0.3);
      }

      .stats-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1),
          rgba(118, 75, 162, 0.1)
        );
        border-radius: 15px;
        padding: 20px;
        text-align: center;
      }

      .stat-number {
        font-size: 2em;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #718096;
        font-size: 14px;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        z-index: 1000;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      .close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
        color: #718096;
      }

      .sync-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #718096;
      }

      .sync-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #48bb78;
      }

      .sync-indicator.syncing {
        background: #ed8936;
        animation: pulse 1s infinite;
      }

      .sync-indicator.error {
        background: #e53e3e;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .sign-out-btn {
        background: linear-gradient(135deg, #e53e3e, #c53030);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .sign-out-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(229, 62, 62, 0.4);
      }

      @media (max-width: 768px) {
        .controls {
          grid-template-columns: 1fr;
        }

        .timeline-header {
          flex-direction: column;
          gap: 15px;
        }

        .timeline-controls {
          flex-direction: column;
          width: 100%;
        }

        .scroll-controls {
          justify-content: center;
        }

        .zoom-slider {
          width: 100%;
        }

        .header {
          flex-direction: column;
          text-align: center;
        }

        .auth-section {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sign In Screen -->
      <div id="signInScreen" class="sign-in-container">
        <h2>Welcome to Your Progress Tracker</h2>
        <p>
          Sign in with Google to save your tasks and access them from anywhere.
        </p>
        <button id="signInBtn" class="google-sign-in-btn">
          <svg class="google-icon" viewBox="0 0 24 24">
            <path
              fill="#4285F4"
              d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
            />
            <path
              fill="#34A853"
              d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
            />
            <path
              fill="#FBBC05"
              d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
            />
            <path
              fill="#EA4335"
              d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
            />
          </svg>
          <span id="signInText">Sign in with Google</span>
        </button>
      </div>

      <!-- Main App -->
      <div id="appContent" class="app-content">
        <div class="header">
          <div class="header-content">
            <h1>What did you get done today?</h1>
            <p>
              Track your daily progress and visualize your journey over time
            </p>
          </div>
          <div class="auth-section">
            <div class="sync-status">
              <div class="sync-indicator" id="syncIndicator"></div>
              <span id="syncText">Synced</span>
            </div>
            <div class="user-info" id="userInfo" style="display: none">
              <img
                id="userAvatar"
                class="user-avatar"
                src=""
                alt="User Avatar"
              />
              <div>
                <div id="userName" style="font-weight: 600"></div>
                <div
                  style="font-size: 12px; color: #718096"
                  id="userEmail"
                ></div>
              </div>
            </div>
            <button id="signOutBtn" class="sign-out-btn" style="display: none">
              Sign Out
            </button>
          </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
          <button class="nav-tab active" onclick="switchTab('timeline')">
            Timeline
          </button>
          <button class="nav-tab" onclick="switchTab('tasks')">
            Task List
          </button>
          <button class="nav-tab" onclick="switchTab('settings')">
            Settings
          </button>
        </div>

        <!-- Timeline Tab -->
        <div id="timelineTab" class="tab-content active">
          <div class="controls">
            <div class="control-group">
              <h3>Add New Task</h3>
              <input type="text" id="newTaskName" placeholder="Task name" />
              <input
                type="text"
                id="newTaskProject"
                placeholder="Project name"
              />
              <div class="priority-input">
                <label style="width: 60px">Priority:</label>
                <input
                  type="range"
                  class="priority-slider"
                  id="newTaskPriority"
                  min="1"
                  max="10"
                  value="5"
                />
                <span class="priority-value" id="newPriorityValue">5</span>
              </div>
              <input
                type="number"
                id="newTaskDuration"
                placeholder="Duration (minutes)"
                min="1"
              />
              <input type="date" id="newTaskStart" />
              <input type="date" id="newTaskEnd" />
              <button onclick="addNewTask()">Add Task</button>
            </div>

            <div class="control-group">
              <h3>Continue Yesterday's Task</h3>
              <select id="continueTask">
                <option value="">Select a task...</option>
              </select>
              <button onclick="continueTask()">Continue Task</button>
            </div>

            <div class="control-group">
              <h3>End Task Today</h3>
              <select id="endTask">
                <option value="">Select a task...</option>
              </select>
              <button onclick="endTask()">End Task</button>
            </div>
          </div>

          <div class="timeline-container">
            <div class="timeline-header">
              <h3>Timeline View</h3>
              <div class="timeline-controls">
                <div class="scroll-controls">
                  <button
                    class="scroll-btn"
                    onclick="scrollTimeline(-7)"
                    title="Previous Week"
                  >
                    ‹‹
                  </button>
                  <button
                    class="scroll-btn"
                    onclick="scrollTimeline(-1)"
                    title="Previous Day"
                  >
                    ‹
                  </button>
                  <button
                    class="today-btn"
                    onclick="goToToday()"
                    title="Go to Today"
                  >
                    Today
                  </button>
                  <button
                    class="scroll-btn"
                    onclick="scrollTimeline(1)"
                    title="Next Day"
                  >
                    ›
                  </button>
                  <button
                    class="scroll-btn"
                    onclick="scrollTimeline(7)"
                    title="Next Week"
                  >
                    ››
                  </button>
                </div>
                <div style="display: flex; align-items: center; gap: 15px">
                  <span>Zoom:</span>
                  <input
                    type="range"
                    class="zoom-slider"
                    id="zoomSlider"
                    min="1"
                    max="5"
                    value="3"
                    step="1"
                  />
                  <span id="zoomLabel">2 Weeks</span>
                </div>
              </div>
            </div>

            <div class="gantt-chart" id="ganttChart">
              <!-- Chart will be populated by JavaScript -->
            </div>

            <div class="timeline-info" id="timelineInfo">Viewing today</div>
          </div>

          <div class="stats-panel">
            <h3 style="margin-bottom: 20px">Statistics</h3>
            <div class="stats-grid" id="statsGrid">
              <!-- Stats will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Task List Tab -->
        <div id="tasksTab" class="tab-content">
          <div class="task-list-container">
            <h3>Prioritized Task List</h3>
            <div class="task-filters">
              <div>
                <label style="font-weight: 600; margin-right: 10px"
                  >Filter by Project:</label
                >
                <div class="project-filter" id="projectFilter">
                  <!-- Project checkboxes will be populated by JavaScript -->
                </div>
              </div>
            </div>
            <div class="task-list" id="taskList">
              <!-- Tasks will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
          <div class="settings-container">
            <h3>Default Values</h3>
            <div class="settings-group">
              <label for="defaultPriority">Default Priority (1-10):</label>
              <div class="priority-input">
                <input
                  type="range"
                  class="priority-slider"
                  id="defaultPriority"
                  min="1"
                  max="10"
                  value="5"
                />
                <span class="priority-value" id="defaultPriorityValue">5</span>
              </div>
            </div>
            <div class="settings-group">
              <label for="defaultDuration">Default Duration (minutes):</label>
              <input
                type="number"
                id="defaultDuration"
                placeholder="30"
                min="1"
                value="30"
              />
            </div>
            <div class="settings-group">
              <label for="defaultProject">Default Project:</label>
              <input type="text" id="defaultProject" placeholder="General" />
            </div>
            <button onclick="saveSettings()">Save Settings</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Task Edit Modal -->
    <div id="taskModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Edit Task</h3>
        <input type="text" id="editTaskName" placeholder="Task name" />
        <input type="text" id="editTaskProject" placeholder="Project name" />
        <div class="priority-input">
          <label style="width: 60px">Priority:</label>
          <input
            type="range"
            class="priority-slider"
            id="editTaskPriority"
            min="1"
            max="10"
            value="5"
          />
          <span class="priority-value" id="editPriorityValue">5</span>
        </div>
        <input
          type="number"
          id="editTaskDuration"
          placeholder="Duration (minutes)"
          min="1"
        />
        <input type="date" id="editTaskStart" />
        <input type="date" id="editTaskEnd" />
        <select id="editTaskStatus">
          <option value="active">Active</option>
          <option value="completed">Completed</option>
        </select>
        <button onclick="saveTaskEdit()">Save Changes</button>
        <button onclick="deleteTask()" style="background: #e53e3e">
          Delete Task
        </button>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        onSnapshot,
        collection,
        query,
        where,
        orderBy,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
        authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
        projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
        storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
        messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
        appId: import.meta.env.VITE_FIREBASE_APP_ID,
        measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID,
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const provider = new GoogleAuthProvider();

      // Global variables
      window.auth = auth;
      window.db = db;
      window.currentUser = null;
      window.tasks = [];
      window.currentEditingTask = null;
      window.zoomLevel = 3;
      window.timelineOffset = 0;
      window.unsubscribeFromTasks = null;
      window.settings = {
        defaultPriority: 5,
        defaultDuration: 30,
        defaultProject: "General",
      };

      const zoomOptions = {
        1: { days: 3, label: "3 Days" },
        2: { days: 7, label: "1 Week" },
        3: { days: 14, label: "2 Weeks" },
        4: { days: 30, label: "1 Month" },
        5: { days: 365, label: "1 Year" },
      };

      // Authentication functions
      window.signInWithGoogle = async function () {
        try {
          setSyncStatus("syncing", "Signing in...");
          const result = await signInWithPopup(auth, provider);
          window.currentUser = result.user;
          showApp();
          setSyncStatus("synced", "Synced");
        } catch (error) {
          console.error("Sign in error:", error);
          setSyncStatus("error", "Sign in failed");
          alert("Sign in failed. Please try again.");
        }
      };

      window.signOutUser = async function () {
        try {
          if (window.unsubscribeFromTasks) {
            window.unsubscribeFromTasks();
            window.unsubscribeFromTasks = null;
          }
          await signOut(auth);
          window.currentUser = null;
          window.tasks = [];
          showSignIn();
        } catch (error) {
          console.error("Sign out error:", error);
          alert("Sign out failed. Please try again.");
        }
      };

      // Database functions
      window.saveTasks = async function () {
        if (!window.currentUser) return;

        try {
          setSyncStatus("syncing", "Saving...");
          const userTasksRef = doc(db, "users", window.currentUser.uid);
          const tasksToSave = window.tasks.map((task) => ({
            ...task,
            startDate: task.startDate.toISOString(),
            endDate: task.endDate.toISOString(),
            updatedAt: new Date().toISOString(),
          }));

          await setDoc(
            userTasksRef,
            {
              tasks: tasksToSave,
              settings: window.settings,
              lastUpdated: new Date().toISOString(),
            },
            { merge: true }
          );

          setSyncStatus("synced", "Synced");
        } catch (error) {
          console.error("Save error:", error);
          setSyncStatus("error", "Save failed");
        }
      };

      window.loadTasks = async function () {
        if (!window.currentUser) return;

        try {
          setSyncStatus("syncing", "Loading...");

          // Set up real-time listener
          const userTasksRef = doc(db, "users", window.currentUser.uid);
          window.unsubscribeFromTasks = onSnapshot(userTasksRef, (doc) => {
            if (doc.exists()) {
              const data = doc.data();
              if (data.tasks) {
                window.tasks = data.tasks.map((task) => ({
                  ...task,
                  startDate: new Date(task.startDate),
                  endDate: new Date(task.endDate),
                  priority: task.priority || window.settings.defaultPriority,
                  duration: task.duration || window.settings.defaultDuration,
                  project: task.project || window.settings.defaultProject,
                }));
                updateView();
              }
              if (data.settings) {
                window.settings = data.settings;
                loadSettings();
              }
            }
            setSyncStatus("synced", "Synced");
          });
        } catch (error) {
          console.error("Load error:", error);
          setSyncStatus("error", "Load failed");
        }
      };

      // Task scoring algorithm
      window.calculateTaskScore = function (task) {
        const now = new Date();
        const daysOpen = Math.floor(
          (now - task.startDate) / (1000 * 60 * 60 * 24)
        );

        // Priority component (75%)
        const priorityScore = (task.priority / 10) * 0.75;

        // Days open component (12.5%)
        const daysOpenScore = Math.min(daysOpen / 30, 1) * 0.125;

        // Duration component (12.5%)
        let durationScore = 0;
        if (task.duration <= 10) {
          durationScore = 0.125; // Full bonus for very short tasks
        } else if (task.duration <= 20) {
          durationScore = 0.0625; // Half bonus for short tasks
        } else {
          durationScore = 0.03125; // Small bonus for longer tasks
        }

        return priorityScore + daysOpenScore + durationScore;
      };

      // UI functions
      function showSignIn() {
        document.getElementById("signInScreen").style.display = "block";
        document.getElementById("appContent").classList.remove("visible");
      }

      function showApp() {
        document.getElementById("signInScreen").style.display = "none";
        document.getElementById("appContent").classList.add("visible");

        // Update user info
        if (window.currentUser) {
          document.getElementById("userInfo").style.display = "flex";
          document.getElementById("signOutBtn").style.display = "block";
          document.getElementById("userAvatar").src =
            window.currentUser.photoURL || "";
          document.getElementById("userName").textContent =
            window.currentUser.displayName || "User";
          document.getElementById("userEmail").textContent =
            window.currentUser.email || "";

          loadTasks();
          updateView();
          setDefaultDates();
        }
      }

      function setSyncStatus(status, text) {
        const indicator = document.getElementById("syncIndicator");
        const statusText = document.getElementById("syncText");

        indicator.className = `sync-indicator ${status}`;
        statusText.textContent = text;
      }

      // Initialize authentication state listener
      onAuthStateChanged(auth, (user) => {
        if (user) {
          window.currentUser = user;
          showApp();
        } else {
          window.currentUser = null;
          showSignIn();
        }
      });

      // Set up event listeners immediately (module scripts run after DOM is ready)
      function setupEventListeners() {
        // Sign in button
        const signInBtn = document.getElementById("signInBtn");
        if (signInBtn) {
          signInBtn.addEventListener("click", async function () {
            console.log("Sign in button clicked"); // Debug log
            const signInText = document.getElementById("signInText");
            signInText.innerHTML = '<div class="loading"></div>';
            try {
              await window.signInWithGoogle();
            } catch (error) {
              console.error("Sign in error:", error);
              signInText.textContent = "Sign in with Google";
            }
          });
        }

        // Sign out button
        const signOutBtn = document.getElementById("signOutBtn");
        if (signOutBtn) {
          signOutBtn.addEventListener("click", window.signOutUser);
        }

        // Zoom slider
        const zoomSlider = document.getElementById("zoomSlider");
        if (zoomSlider) {
          zoomSlider.addEventListener("input", function (e) {
            window.zoomLevel = parseInt(e.target.value);
            document.getElementById("zoomLabel").textContent =
              zoomOptions[window.zoomLevel].label;
            renderGanttChart();
          });
        }

        // Priority sliders
        const newPrioritySlider = document.getElementById("newTaskPriority");
        if (newPrioritySlider) {
          newPrioritySlider.addEventListener("input", function (e) {
            document.getElementById("newPriorityValue").textContent =
              e.target.value;
          });
        }

        const editPrioritySlider = document.getElementById("editTaskPriority");
        if (editPrioritySlider) {
          editPrioritySlider.addEventListener("input", function (e) {
            document.getElementById("editPriorityValue").textContent =
              e.target.value;
          });
        }

        const defaultPrioritySlider =
          document.getElementById("defaultPriority");
        if (defaultPrioritySlider) {
          defaultPrioritySlider.addEventListener("input", function (e) {
            document.getElementById("defaultPriorityValue").textContent =
              e.target.value;
          });
        }
      }

      // Call setupEventListeners immediately since module scripts defer by default
      setupEventListeners();

      // Tab switching
      window.switchTab = function (tabName) {
        // Hide all tabs
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Remove active class from all nav tabs
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab
        document.getElementById(tabName + "Tab").classList.add("active");

        // Add active class to clicked nav tab
        event.target.classList.add("active");

        // Update task list if switching to tasks tab
        if (tabName === "tasks") {
          updateTaskList();
        }
      };

      // Settings functions
      window.saveSettings = function () {
        window.settings = {
          defaultPriority: parseInt(
            document.getElementById("defaultPriority").value
          ),
          defaultDuration: parseInt(
            document.getElementById("defaultDuration").value
          ),
          defaultProject:
            document.getElementById("defaultProject").value || "General",
        };

        saveTasks(); // This will save settings too
        alert("Settings saved successfully!");
      };

      window.loadSettings = function () {
        document.getElementById("defaultPriority").value =
          window.settings.defaultPriority;
        document.getElementById("defaultPriorityValue").textContent =
          window.settings.defaultPriority;
        document.getElementById("defaultDuration").value =
          window.settings.defaultDuration;
        document.getElementById("defaultProject").value =
          window.settings.defaultProject;
      };

      // Task management functions
      window.addNewTask = function () {
        const name = document.getElementById("newTaskName").value;
        const project =
          document.getElementById("newTaskProject").value ||
          window.settings.defaultProject;
        const priority =
          parseInt(document.getElementById("newTaskPriority").value) ||
          window.settings.defaultPriority;
        const duration =
          parseInt(document.getElementById("newTaskDuration").value) ||
          window.settings.defaultDuration;
        const startDate = new Date(
          document.getElementById("newTaskStart").value
        );
        const endDate = new Date(document.getElementById("newTaskEnd").value);

        if (!name || !startDate || !endDate) {
          alert("Please fill in task name and dates");
          return;
        }

        const newTask = {
          id: Date.now().toString(),
          name: name,
          project: project,
          priority: priority,
          duration: duration,
          startDate: startDate,
          endDate: endDate,
          status: "active",
        };

        window.tasks.push(newTask);
        saveTasks();
        updateView();

        // Clear inputs
        document.getElementById("newTaskName").value = "";
        document.getElementById("newTaskProject").value = "";
        document.getElementById("newTaskPriority").value =
          window.settings.defaultPriority;
        document.getElementById("newPriorityValue").textContent =
          window.settings.defaultPriority;
        document.getElementById("newTaskDuration").value = "";
        document.getElementById("newTaskStart").value = "";
        document.getElementById("newTaskEnd").value = "";
      };

      window.continueTask = function () {
        const taskId = document.getElementById("continueTask").value;
        if (!taskId) return;

        const task = window.tasks.find((t) => t.id === taskId);
        if (task) {
          task.endDate = new Date();
          task.status = "active";
          saveTasks();
          updateView();
        }
      };

      window.endTask = function () {
        const taskId = document.getElementById("endTask").value;
        if (!taskId) return;

        const task = window.tasks.find((t) => t.id === taskId);
        if (task) {
          task.endDate = new Date();
          task.status = "completed";
          saveTasks();
          updateView();
        }
      };

      window.scrollTimeline = function (days) {
        window.timelineOffset += days;
        renderGanttChart();
      };

      window.goToToday = function () {
        window.timelineOffset = 0;
        renderGanttChart();
      };

      window.closeModal = function () {
        document.getElementById("taskModal").style.display = "none";
      };

      window.saveTaskEdit = function () {
        if (!window.currentEditingTask) return;

        window.currentEditingTask.name =
          document.getElementById("editTaskName").value;
        window.currentEditingTask.project =
          document.getElementById("editTaskProject").value ||
          window.settings.defaultProject;
        window.currentEditingTask.priority = parseInt(
          document.getElementById("editTaskPriority").value
        );
        window.currentEditingTask.duration =
          parseInt(document.getElementById("editTaskDuration").value) ||
          window.settings.defaultDuration;
        window.currentEditingTask.startDate = new Date(
          document.getElementById("editTaskStart").value
        );
        window.currentEditingTask.endDate = new Date(
          document.getElementById("editTaskEnd").value
        );
        window.currentEditingTask.status =
          document.getElementById("editTaskStatus").value;

        saveTasks();
        updateView();
        closeModal();
      };

      window.deleteTask = function () {
        if (!window.currentEditingTask) return;

        if (confirm("Are you sure you want to delete this task?")) {
          window.tasks = window.tasks.filter(
            (t) => t.id !== window.currentEditingTask.id
          );
          saveTasks();
          updateView();
          closeModal();
        }
      };

      window.updateView = function () {
        renderGanttChart();
        updateTaskSelects();
        updateStats();
        updateProjectFilter();
      };

      window.setDefaultDates = function () {
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("newTaskStart").value = today;
        document.getElementById("newTaskEnd").value = today;

        // Set default values
        document.getElementById("newTaskPriority").value =
          window.settings.defaultPriority;
        document.getElementById("newPriorityValue").textContent =
          window.settings.defaultPriority;
      };

      window.updateTaskSelects = function () {
        const continueSelect = document.getElementById("continueTask");
        const endSelect = document.getElementById("endTask");

        // Clear existing options
        continueSelect.innerHTML = '<option value="">Select a task...</option>';
        endSelect.innerHTML = '<option value="">Select a task...</option>';

        // Add tasks to selects
        window.tasks.forEach((task) => {
          if (task.status === "completed") {
            // Can continue completed tasks
            const option = document.createElement("option");
            option.value = task.id;
            option.textContent = `${task.name} (${task.project})`;
            continueSelect.appendChild(option);
          } else {
            // Can end active tasks
            const option = document.createElement("option");
            option.value = task.id;
            option.textContent = `${task.name} (${task.project})`;
            endSelect.appendChild(option);
          }
        });
      };

      window.renderGanttChart = function () {
        const chart = document.getElementById("ganttChart");
        const zoom = zoomOptions[window.zoomLevel];
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const startDate = new Date(today);
        startDate.setDate(
          startDate.getDate() +
            window.timelineOffset -
            Math.floor(zoom.days / 2)
        );

        const endDate = new Date(startDate);
        endDate.setDate(endDate.getDate() + zoom.days);

        // Create header
        let html =
          '<div class="chart-header"><div class="task-column">Tasks</div><div class="timeline-column"><div class="date-markers">';

        // Add date markers
        for (
          let d = new Date(startDate);
          d <= endDate;
          d.setDate(d.getDate() + 1)
        ) {
          const isToday = d.toDateString() === today.toDateString();
          const dayOfWeek = d.toLocaleDateString("en-US", { weekday: "short" });
          const dayOfMonth = d.getDate();

          html += `<div class="date-marker ${isToday ? "today" : ""}">
                    <div>${dayOfWeek}</div>
                    <div>${dayOfMonth}</div>
                </div>`;
        }

        html += "</div></div></div>";

        // Add tasks
        window.tasks.forEach((task) => {
          const taskStart = new Date(Math.max(task.startDate, startDate));
          const taskEnd = new Date(Math.min(task.endDate, endDate));

          if (taskEnd >= startDate && taskStart <= endDate) {
            const totalDays = (endDate - startDate) / (1000 * 60 * 60 * 24);
            const leftPercent = Math.max(
              0,
              ((taskStart - startDate) / (1000 * 60 * 60 * 24) / totalDays) *
                100
            );
            const widthPercent =
              ((taskEnd - taskStart) / (1000 * 60 * 60 * 24) / totalDays) * 100;

            html += `<div class="chart-row">
                        <div class="task-info">
                            <div class="task-name">${task.name}</div>
                            <div class="task-duration">${task.startDate.toLocaleDateString()} - ${task.endDate.toLocaleDateString()}</div>
                            <div class="project-badge">${task.project}</div>
                        </div>
                        <div class="timeline-row">
                            <div class="task-bar ${task.status}" 
                                 style="left: ${leftPercent}%; width: ${widthPercent}%;"
                                 onclick="editTask('${task.id}')">
                                ${task.name}
                            </div>
                        </div>
                    </div>`;
          }
        });

        chart.innerHTML = html;

        // Update timeline info
        const centerDate = new Date(startDate);
        centerDate.setDate(centerDate.getDate() + Math.floor(zoom.days / 2));
        document.getElementById("timelineInfo").textContent =
          `Viewing ${centerDate.toLocaleDateString()}`;
      };

      window.editTask = function (taskId) {
        const task = window.tasks.find((t) => t.id === taskId);
        if (!task) return;

        window.currentEditingTask = task;

        document.getElementById("editTaskName").value = task.name;
        document.getElementById("editTaskProject").value = task.project;
        document.getElementById("editTaskPriority").value = task.priority;
        document.getElementById("editPriorityValue").textContent =
          task.priority;
        document.getElementById("editTaskDuration").value = task.duration;
        document.getElementById("editTaskStart").value = task.startDate
          .toISOString()
          .split("T")[0];
        document.getElementById("editTaskEnd").value = task.endDate
          .toISOString()
          .split("T")[0];
        document.getElementById("editTaskStatus").value = task.status;

        document.getElementById("taskModal").style.display = "block";
      };

      window.updateStats = function () {
        const stats = {
          total: window.tasks.length,
          active: window.tasks.filter((t) => t.status === "active").length,
          completed: window.tasks.filter((t) => t.status === "completed")
            .length,
          thisWeek: 0,
          thisMonth: 0,
          totalHours: 0,
        };

        const now = new Date();
        const weekAgo = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate() - 7
        );
        const monthAgo = new Date(
          now.getFullYear(),
          now.getMonth() - 1,
          now.getDate()
        );

        window.tasks.forEach((task) => {
          if (task.startDate >= weekAgo) stats.thisWeek++;
          if (task.startDate >= monthAgo) stats.thisMonth++;
          stats.totalHours += (task.duration || 0) / 60;
        });

        const statsGrid = document.getElementById("statsGrid");
        statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.active}</div>
                    <div class="stat-label">Active Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.completed}</div>
                    <div class="stat-label">Completed Tasks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.thisWeek}</div>
                    <div class="stat-label">Started This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.thisMonth}</div>
                    <div class="stat-label">Started This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalHours.toFixed(1)}</div>
                    <div class="stat-label">Total Hours</div>
                </div>
            `;
      };

      window.updateProjectFilter = function () {
        const projects = [...new Set(window.tasks.map((t) => t.project))];
        const filterDiv = document.getElementById("projectFilter");

        filterDiv.innerHTML = "";

        projects.forEach((project) => {
          const label = document.createElement("label");
          label.className = "project-checkbox";
          label.innerHTML = `
                    <input type="checkbox" value="${project}" checked onchange="updateTaskList()">
                    <span>${project}</span>
                `;
          filterDiv.appendChild(label);
        });
      };

      window.updateTaskList = function () {
        const selectedProjects = Array.from(
          document.querySelectorAll("#projectFilter input:checked")
        ).map((input) => input.value);

        const filteredTasks = window.tasks.filter(
          (task) =>
            task.status === "active" && selectedProjects.includes(task.project)
        );

        // Sort tasks by score
        const sortedTasks = filteredTasks
          .map((task) => ({
            ...task,
            score: calculateTaskScore(task),
          }))
          .sort((a, b) => b.score - a.score);

        const taskListDiv = document.getElementById("taskList");
        taskListDiv.innerHTML = "";

        sortedTasks.forEach((task) => {
          const taskDiv = document.createElement("div");
          taskDiv.className = "task-item";
          taskDiv.onclick = () => editTask(task.id);

          taskDiv.innerHTML = `
                    <div class="task-info-left">
                        <div class="task-title">${task.name}</div>
                        <div class="task-details">
                            <span class="project-badge">${task.project}</span>
                            Priority: ${task.priority}/10 | Duration: ${task.duration}min | 
                            Open for: ${Math.floor((new Date() - task.startDate) / (1000 * 60 * 60 * 24))} days
                        </div>
                    </div>
                    <div class="task-score">Score: ${(task.score * 100).toFixed(1)}</div>
                `;

          taskListDiv.appendChild(taskDiv);
        });

        if (sortedTasks.length === 0) {
          taskListDiv.innerHTML =
            '<p style="text-align: center; color: #718096;">No active tasks found for selected projects.</p>';
        }
      };
    </script>
  </body>
</html>
